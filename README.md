# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка товара
```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

Заказ
```
interface IOrder {
  payment: string;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подиска на событие
- `off` - отписка от события
- `emit` - инициализация события
- `onAll` - подписка на все события
- `offAll` - сброс всех подписчиков
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Component
Является базовым классом для компонентов представления. \
`constructor(protected readonly container: HTMLElement)` Конструктор принимает контейнер компонента.

Методы: 
  - toggleClass - переключает класс элемента
  - setText- устанавливает текстовое содержимое
  - setDisabled -меняет статус блокировки
  - setHidden - скрывает элемент
  - setVisible - показывает элемент
  - setImage - устанавливает изображение
  - render - возвращает корневой DOM-элемент

#### Класс Model
Является базовым классом для моделей данных. \
`constructor(data: Partial<T>, protected events: IEvents)` Конструктор принимает исходные данные, которые будут установлены в класс и события, которые будут сообщать, что произошли изменения.

Метод:
- emitChanges - сообщает всем, что модель изменилась

### Слой данных

#### Класс AppState
Представляет состояние приложение, включает данные каталога карточек, предпросмотр товара, данные корзины, данные заказ и ошибок форм.
Наследуется от класса `Model`.

Содержит поля:
- basket - список товаров в корзине
- catalog - список всех товаров
- order - данные заказа
- formErrors - ошибки валидации формы

Методы:
- clearBasket - очищает список товаров в корзине
- getCounter - получает количество товаров в корзине
- getTotal - получает общую сумму товаров в корзине
- addBasket - добавляет товар в корзину
- removeBasket - удаляет товар из корзины
- setOrderItems - добавляет список товаров из корзины в заказ
- setCatalog - создает список карточек товаров
- setPreview - устанавливает предпросмотр карточки
- setOrderField - заполняет данные формы в заказ
- validateOrder - проверяет валидацию форм
- getCardIndex - формирует порядковый номер элемнта в списке


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Формирует главную страницу магазина.\
Наследуется от класса `Component`. Добавляет слушатель при нажатии на иконку корзины.

Содержит поля:
- _counter - элемент счетчика товаров в корзине
- _catalog - элемент каталога товаров 
- _basket - элемент корзины

Методы:
- set counter - устанавливает значение счетчика товаров в корзине
- set catalog - устанавливает список карточек в корзине


#### Класс Modal
Реализует модальное окно и предоставляет методы `open` и `close` для управления отображения модального окна. Наследуется от класса `Component`. Устанавливает слушатели на клиавиатуру для закрытия модального окна по Esc, на клик на оверлей и кнопку крестик для закрытия попапа. Предоставляет методы для отображения ошибок и управления активностью кнопки. 

Содержит поля:
- _closeButton - кнопка закрытия модального окна
- _content: HTMLElement - содержимое модального окна

Методы:
- open - открывает модальное окно
- close - закрывает модальное окно
- render - рендерит модальное окно с учетом переданных данных


#### Класс Card
Отображает карточку товара на странице, задавая в карточке данные названия, категории, описание, ссылку на изображение, и цену товара. Наследуется от класса `Component`. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируются соответствующие события.

Содержит поля:
- _id - элемент уникального идентификатора товара
- _category - элемент категории товара
- _title - элемент заголовка карточки
- _image - элемент изображения
- _description - - элемент описания карточки
- _price - элемент цены товара
- _button - кнопка для покупки товара
- _index - элемент порядкового номера товара в списке

Методы:
- set id - устанавливает значение идентификатора для карточки
- set title - устанавливает заголовк карточки
- set category - устанавливает категорию товара в карточке
- set description - устанавливает описание карточки
- set price - устанавливает цену товара
- set image - устанавливает изображение для карточки
- buttonDisabled - меняет доступность кнопки для покупки товара


#### Класс Basket
Отображает корзину на странице. Содержит список товаров в корзине, общую сумму товаров, и устанавливает обработчик на кнопку для перехода к оформлению заказа. 
Наследуется от класса `Component`.

Содержит поля:
- _list - список товаров в корзине
- _total - общая сумма товаров в корзине
- _button - кнопка для перехода к оформлению заказа

Методы:
- set items - устанавливает список товаров в корзине
- set total - устанавливает сумму всех товаров в корзине

#### Класс Form
Общий класс для создания и управления формами. \
Наследуется от класса `Component`.

Содержит поля:
- _submit - кнопка отправки формы
- _errors - элемент отображения ошибок валидации формы

Методы:
- onInputChange - сообщает, что в поля ввода внесены изменения
- set valid - устанавливает состояние кнопки в зависимости от валидности формы
- set errors - устанавливает текст ошибок
- render - ренедерит конмпонент формы на странице, устанавливает валидность формы

#### Класс Order
Представляет форму оформления заказа с возможностью выбора способа оплаты и адреса доставки. 
Класс наследуется от `Form`.

Содержит поля:
- _paymentButtons - список кнопок в фомре выбора оплаты

Методы:
- buttonSelect - меняет активность нажатой кнопки
- set address - устанавливает значение адреса


#### Класс Contacts
Представляет форму оформления заказа с указанием электронной почты и номера телефона.
Класс наследуется от `Form`.

Методы:
- set phone - устанавливает значение номера телефона
- set email - устанавливает значение электронной почты


#### Класс Success
Отображает сообщение об успешном оформлении заказа и выводит сумму заказа.\
Наследуется от класса `Component`.

Содержит поля:
- _close - кнопка для закрытия окна
- _total - общая сумма заказа

Методы:
- set total - устанавливает текст общей суммы заказа

### Слой коммуникации

#### Класс ShopApi
Принимает в конструктор экземпляр класса Api и предоствляет методы реализующие взаимодействие с бэкендом сервера.\
Методы:
- getProductList: () => Promise<IProduct[]> - получить список товаров с сервера;
- orderProducts: (order: IOrder) => Promise<IOrderResult[]> - отправить результат заказа.


## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*\
`items: changed` - при изменении списка товаров\
`basket: changed` - при изменении содержимого корзины\

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающих за представление)*\
`card: select` - при нажатии на карточку товара\
`preview:changed` - при открытии карточки товара\
`basket: open` - при открытии корзины\
`basket: add` - при добавлении товара в корзину\
`basket: remove` - при удалении товара из корзины\
`order:open` - при открытии формы 'Order\
`payment:change` - при выборе способа оплаты в форме 'Order'\
`/^order\..*:change/` - при изменении данных в поле 'Адрес доставки'\
`order: submit` - при нажатии на кнопку 'Далее' в форме 'Order'\
`contacts:open` - при открытии формы 'Contacts\
`/^contacts\..*:change/` - при изменении данных в полях 'Email' и 'Телефон'\
`formErrors:change` - при изменении состояния валидации форм
`contacts: submit` - при нажатии на кнопку 'Оплатить' в форме 'Contacts'\