# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка товара
```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

Заказ
```
interface IOrder {
  payment: string;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подиска на событие
- `off` - отписка от события
- `emit` - инициализация события
- `onAll` - подписка на все события
- `offAll` - сброс всех подписчиков
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс BasketModel
Содержит массив товаров в корзине.\
Методы:\
`add` - добавляет товар в корзину\
`remove` - удаляет товар и корзины\
`clear` - удаляет все товары из корзины\
`getItems` - получает список товаров в корзине

```
interface IBasketModel {
  items: Map<string, number>;
  add(id: string): void;
  remove(id: string): void;
  clear(): void;
  getItems(): IProduct[];
}
```

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Формирует главную страницу магазина

```
interface IPage {
  counter: number;
  catalog: HTMLElement[];
}
```

#### Класс Modal
Реализует модальное окно и предоставляет методы `open` и `close` для управления отображения модального окна. Устанавливает слушатели на клиавиатуру для закрытия модального окна по Esc, на клик на оверлей и кнопку крестик для закрытия попапа.
```
interface IModal {
  content: HTMLElement;
}
```

#### Класс Card
Отображает карточку товара на странице, задавая в карточке данные названия, категории, описание, ссылку на изображение, и цену товара. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируются соответствующие события.
Содержит

#### Класс Basket
Отображает корзину на странице.
```
interface IBasketView {
    items: HTMLElement[];
    total: number;
}
```


#### Класс OrderForm
Представляет форму оформления заказа с возможностью выбора способа оплаты и адреса доставки.
```
interface IOrderForm {
  payment: string;
  address: string;
}
```

#### Класс ContactsForm
Представляет форму оформления заказа с указанием электронной почты и номера телефона.
```
interface IContactsForm {
  email: string;
  phone: string;
}
```

#### Класс OrderSuccess
Отображает сообщение об успешном оформлении заказа и выводит сумму заказа.
```
interface ISuccess {
    total: number;
}
```

### Слой коммуникации

#### Класс ShopApi
Принимает в конструктор экземпляр класса Api и предоствляет методы реализующие взаимодействие с бэкендом сервера.\
Методы:
- getProductList: () => Promise<IProduct[]> - получить список товаров с сервера;
- getProductItem: (id: string) => Promise<IProduct> - получить данные одного товара по id;
- orderProducts: (order: IOrder) => Promise<IOrderResult[]> - отправить результат заказа.


## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*\
`items: changed` - при изменении списка товаров\
`basket: changed` - при изменении содержимого корзины\

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающих за представление)*\
`card: select` - при нажатии на карточку товара\
`basket: open` - при открытии корзины\
`basket: add` - при добавлении товара в корзину\
`basket: remove` - при удалении товара из корзины\
`basket: submit` - при нажатии на кнопку 'Оформить' в корзине\
`order: button` - при выборе способа оплаты в форме 'Order'\
`order: input` - при изменении данных в поле 'Адрес доставки'\
`order: validation` - сообщение о необходимости валидации  в форме 'Order'\
`order: submit` - при нажатии на кнопку 'Далее' в форме 'Order'\
`contacts: input` - при изменении данных в полях 'Email' и 'Телефон'\
`contacts: validation` - сообщение о необходимости валидации  в форме 'Contacts'\
`contacts: submit` - при нажатии на кнопку 'Оплатить' в форме 'Contacts'\
