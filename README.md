# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка товара
```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

Заказ
```
interface IOrder {
  payment: string;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов.\

`constructor(baseUrl: string, options: RequestInit = {})`- принимает базовый URL и глобальные опции для всех запросов(опционально)..\

Содержит поля:
- `baseUrl: string` - базовый URL
- `options: RequestInit` - глобальные опции для всех запросов

Методы:
- `handleResponse(response: Response): Promise<object>` - обрабатывает ответ сервера. Если есть ответ сервера, то возвращает его, если ответа нет, возвращает ошибку.
- `get(uri: string)` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Содержит поля:
- `_events: Map<EventName, Set<Subscriber>>` - коллекция состоящая из события и подписчика

Методы:
- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - подиска на событие
- `off(eventName: EventName, callback: Subscriber)` - отписка от события
- `emit<T extends object>(eventName: string, data?: T)` - инициализация события
- `onAll(callback: (event: EmitterEvent) => void)` - подписка на все события
- `offAll()` - сброс всех подписчиков
- `rigger<T extends object>(eventName: string, context?: Partial<T>)` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Component
Является базовым классом для компонентов представления. \

`constructor(protected readonly container: HTMLElement)` Конструктор принимает контейнер компонента.

Методы: 
  - `toggleClass(element: HTMLElement, className: string, force?: boolean)` - переключает класс элемента
  - `setText(element: HTMLElement, value: unknown)`- устанавливает текстовое содержимое
  - `setDisabled(element: HTMLElement, state: boolean)` - меняет статус блокировки
  - `setHidden(element: HTMLElement)` - скрывает элемент
  - `setVisible(element: HTMLElement)` - показывает элемент
  - `setImage(element: HTMLImageElement, src: string, alt?: string)` - устанавливает изображение
  - `render(data?: Partial<T>): HTMLElement` - возвращает корневой DOM-элемент

#### Класс Model
Является базовым классом для моделей данных. \
`constructor(data: Partial<T>, protected events: IEvents)` Конструктор принимает исходные данные, которые будут установлены в класс и события, которые будут сообщать, что произошли изменения.

Метод:
- `emitChanges(event: string, payload?: object)` - сообщает всем, что модель изменилась

### Слой данных

#### Класс AppState
Представляет состояние приложение, включает данные каталога карточек, предпросмотр товара, данные корзины, данные заказ и ошибок форм.
Наследуется от класса `Model`.

Содержит поля:
- `basket: Product[]` - список товаров в корзине
- `catalog: Product[]` - список всех товаров
- `order: IOrder` - данные заказа
- `formErrors: FormErrors = {}` - ошибки валидации формы

Методы:
- `clearBasket()` - очищает список товаров в корзине
- `getCounter()` - получает количество товаров в корзине
- `getTotal()` - получает общую сумму товаров в корзине
- `addBasket(item: Product)` - добавляет товар в корзину
- `removeBasket(item: Product)` - удаляет товар из корзины
- `setOrderItems()` - добавляет список товаров из корзины в заказ
- `setCatalog(items: Product[])` - создает список карточек товаров
- `setPreview(item: Card)` - устанавливает предпросмотр карточки
- `setOrderField(field: keyof IOrderForm | keyof IContactsForm, value: string)` - заполняет данные формы в заказ
- `validateOrder()` - проверяет валидацию форм
- `getCardIndex(item: Product)` - формирует порядковый номер элемента в списке


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Формирует главную страницу магазина.\
Наследуется от класса `Component`. Добавляет слушатель при нажатии на иконку корзины.

`constructor(container: HTMLElement, protected events: IEvents)` - конструктор принимает контейнер страницы и объект для управления событиями

Содержит поля:
- `_counter: HTMLElement` - элемент счетчика товаров в корзине
- `_catalog: HTMLElement` - элемент каталога товаров 
- `_wrapper: HTMLElement` - элемент обертки страницы
- `_basket: HTMLElement` - элемент корзины

Сеттеры:
- `set counter(value: number)` - устанавливает значение счетчика товаров в корзине
- `set catalog(items: HTMLElement[])` - устанавливает список карточек в корзине
- `set locked(value: boolean)` - устанавливает блокировку страницы


#### Класс Modal
Реализует модальное окно и предоставляет методы `open` и `close` для управления отображения модального окна. Наследуется от класса `Component`. Устанавливает слушатели на клиавиатуру для закрытия модального окна по Esc, на клик на оверлей и кнопку крестик для закрытия попапа. Предоставляет методы для отображения ошибок и управления активностью кнопки. 

`constructor(container: HTMLElement, protected events: IEvents)`- конструктор принимает контейнер модального окна и объект для управления событиями

Содержит поля:
- `_closeButton: HTMLButtonElement` - кнопка закрытия модального окна
- `_content: HTMLElement` - содержимое модального окна

Методы и сеттеры:
- `_toggleModal(state: boolean = true)` - метод для переключения модального окна, чтобы не передавать селектор и контейнер каждый раз
- `set content(value: HTMLElement)` - устанавливает содержимое модального окна
- `open()` - открывает модальное окно
- `close()` - закрывает модальное окно
- `render(data: IModalData): HTMLElement` - рендерит модальное окно с учетом переданных данных


#### Класс Card
Отображает карточку товара на странице, задавая в карточке данные названия, категории, описание, ссылку на изображение, и цену товара. Наследуется от класса `Component`. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируются соответствующие события.

`constructor(container: HTMLElement, actions?: ICardActions)` - конструктор принимает контейнер карточки товара и объект для управления событиями.

Содержит поля:
- `_id: HTMLElement` - элемент уникального идентификатора товара
- `_category: HTMLElement` - элемент категории товара
- `_title: HTMLElement` - элемент заголовка карточки
- `_image?: HTMLImageElement` - элемент изображения
- `_description?: HTMLElement` - - элемент описания карточки
- `_price: HTMLElement` - элемент цены товара
- `_button?: HTMLButtonElement` - кнопка для покупки товара
- `_index?: HTMLElement` - элемент порядкового номера товара в списке

Методы и сеттеры:
- `set id(value: string)` - устанавливает значение идентификатора для карточки
- `set title(value: string)` - устанавливает заголовк карточки
- `set category(value: string)` - устанавливает категорию товара в карточке
- `set description(value: string)` - устанавливает описание карточки
- `set price(value: number)` - устанавливает цену товара
- `set image(value: string)` - устанавливает изображение для карточки
- `set index(value: number)` - устанавливает порядковый номер товара в корзине
- `disableButton(items: Product[], id: string, price: number | null)` - меняет доступность кнопки для покупки товара


#### Класс Basket
Отображает корзину на странице. Содержит список товаров в корзине, общую сумму товаров, и устанавливает обработчик на кнопку для перехода к оформлению заказа. 
Наследуется от класса `Component`.

`constructor(container: HTMLElement, protected events: EventEmitter)` - конструктор принимает контейнер корзины и объект для управления событиями.

Содержит поля:
- `_list: HTMLElement` - список товаров в корзине
- `_total: HTMLElement` - общая сумма товаров в корзине
- `_button: HTMLButtonElement` - кнопка для перехода к оформлению заказа

Сеттеры:
- `set items(items: HTMLElement[])` - устанавливает список товаров в корзине
- `set total(total: number)` - устанавливает сумму всех товаров в корзине

#### Класс Form
Общий класс для создания и управления формами. \
Наследуется от класса `Component`.

`constructor(protected container: HTMLFormElement, protected events: IEvents)` - конструктор принимает контейнер формы и объект для управления событиями.

Содержит поля:
- `_submit: HTMLButtonElement` - элемент кнопки отправки формы
- `_errors: HTMLElement` - элемент отображения ошибок валидации формы

Методы и сеттеры:
- `onInputChange(field: keyof T, value: string)` - сообщает, что в поля ввода внесены изменения
- `set valid(value: boolean)` - устанавливает состояние кнопки в зависимости от валидности формы
- `set errors(value: string)` - устанавливает текст ошибок
- `render(state: Partial<T> & IFormState)` - ренедерит конмпонент формы на странице, устанавливает валидность формы

#### Класс Order
Представляет форму оформления заказа с возможностью выбора способа оплаты и адреса доставки. 
Класс наследуется от `Form`.

`constructor(container: HTMLFormElement, events: IEvents)` - конструктор принимает контейнер формы оформления заказа и объект для управления событиями.

Содержит поля:
- `_paymentButtons: HTMLButtonElement[]` - список кнопок в форме выбора оплаты

Методы и сеттеры:
- `selectButton(name: string)` - меняет активность нажатой кнопки
- `set address(value: string)` - устанавливает значение адреса


#### Класс Contacts
Представляет форму оформления заказа с указанием электронной почты и номера телефона.
Класс наследуется от `Form`.

`constructor(container: HTMLFormElement, events: IEvents)` - конструктор принимает контейнер формы контактных данных и объект для управления событиями.

Сеттеры:
- `set phone(value: string)` - устанавливает значение номера телефона
- `set email(value: string)` - устанавливает значение электронной почты


#### Класс Success
Отображает сообщение об успешном оформлении заказа и выводит сумму заказа.\
Наследуется от класса `Component`.

`constructor(container: HTMLElement, actions: ISuccessActions)` - принимает контейнер элемента и объект для управления событиями

Содержит поля:
- `_close: HTMLElement` - элемент кнопки для закрытия окна
- `_total: HTMLParagraphElement` - элемент для отображения общей суммы заказа

Сеттер:
- `set total(value: number)` - устанавливает текст общей суммы заказа

### Слой коммуникации

#### Класс ShopApi
Класс принимает экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервера.\

`constructor(cdn: string, baseUrl: string, options?: RequestInit)`- Конструктор принимает базовый URL и глобальные опции для всех запросов .\

Содержит поля:
- `cdn: string` - URL адрес CDN

Методы:
- `getProductList: () => Promise<IProduct[]>` - получает список товаров с сервера;
- `orderProducts: (order: IOrder) => Promise<IOrderResult[]>` - отправляет результат заказа на сервер


## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*\
`items: changed` - при изменении списка товаров\
`basket: changed` - при изменении содержимого корзины\

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающих за представление)*\
`card: select` - при нажатии на карточку товара\
`preview:changed` - при открытии карточки товара\
`basket: open` - при открытии корзины\
`basket: add` - при добавлении товара в корзину\
`basket: remove` - при удалении товара из корзины\
`order:open` - при открытии формы 'Order\
`payment:change` - при выборе способа оплаты в форме 'Order'\
`/^order\..*:change/` - при изменении данных в поле 'Адрес доставки'\
`order: submit` - при нажатии на кнопку 'Далее' в форме 'Order'\
`contacts:open` - при открытии формы 'Contacts\
`/^contacts\..*:change/` - при изменении данных в полях 'Email' и 'Телефон'\
`formErrors:change` - при изменении состояния валидации форм
`contacts: submit` - при нажатии на кнопку 'Оплатить' в форме 'Contacts'\